/******************************************************************************
*** HELPERFUNCTIONS 
*** Author:    Anton Agana
***
*** Helper functions.
*** 
******************************************************************************/
var HELPERFUNCTIONS=function(e){"use strict";function n(e,t){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState===4&&(n.status===200?t(JSON.parse(n.responseText)):console.error(n))},n.open("GET",e,!0),n.send()}function r(e,t){for(var n=e.children.length-1;n>=0;n--)if(e.children[n].className.indexOf(t)>-1)return e.children[n];console.log("ERROR: child not found")}var t=e||{};return t.loadJsonViaAjax=n,t.getChildWithClassName=r,t}(HELPERFUNCTIONS),HELPERFUNCTIONSFLICKR=function(e){"use strict";function r(e){var t=n.pop();if(e.items.length===0){var r="Your keyword '"+t[0]+"' did not match any pic tags on Flickr. "+"Carousel won't be created.";alert(r);return}var i=e.items.map(function(e){return{path:e.media.m.replace("_m.jpg","_z.jpg"),title:e.title}}),s=t[1];s(i)}function i(e,t){n.push([e,t]);var r=document.createElement("script");r.type="text/javascript",r.src="http://api.flickr.com/services/feeds/photos_public.gne?tags="+e+"+pic+%22&tagmode=any&format=json&jsoncallback="+"HELPERFUNCTIONSFLICKR.jsonFlickrFeedHandler",document.body.appendChild(r)}var t=e||{};t.handleFlickrRequest=i,t.jsonFlickrFeedHandler=r;var n=[];return t}(HELPERFUNCTIONSFLICKR),CAROUSELCONTROLLER=function(e,t){"use strict";function i(e){clearInterval(e.dataset.intervId),e.dataset.intervId=""}function s(e){var t=Number(e.dataset.autoStep),n=Number(e.dataset.time),r=setInterval(function(){o(e,t)},n);e.dataset.intervId=r}function o(e,t){var r=n.getChildWithClassName(n.getChildWithClassName(e,"viewport"),"filmstrip"),i=Number(r.style.marginLeft.replace("px","")),s=Number(r.dataset.totalWidth);i+=t,Math.abs(i)===s?i=0:i>0&&(i=-(s-t)),r.style.marginLeft=i+"px",e.dataset.autoStep=t}function u(e,t){var r=n.getChildWithClassName(n.getChildWithClassName(e,"viewport"),"filmstrip"),i=Number(r.style.marginLeft.replace("px","")),s=Number(e.dataset.viewingWidth),o=Math.abs(i/s),u=r.children[o].firstChild;t.download=u.alt.trim().split(" ").join("_").split('"').join("").split("'").join(""),t.href=u.src}function a(e){e.dataset.intervId?i(e):s(e)}var n=e.HELPERFUNCTIONS||{},r=t||{};return r.stopCarousel=i,r.autoMove=s,r.moveCarouselByStep=o,r.downloadVisiblePhotoHandler=u,r.pauseButtonHandler=a,r}(this,CAROUSELCONTROLLER),CAROUSELVIEW=function(e,t){"use strict";function i(e,t){t.images=e.slice(),o(t),s(t)}function s(e){var t=document.createElement("div"),r=document.createElement("div"),i=document.createElement("div"),s=document.createElement("a"),o=document.createElement("a");t.className="navigation",r.className="chevron rightChev",i.className="chevron leftChev",s.className="download",o.className="pause",r.dataset.step=-e.options.w,i.dataset.step=e.options.w,e.carousel.dataset.autoStep=-e.options.w,e.carousel.dataset.time=e.options.time,s.download=!0,t.appendChild(i),t.appendChild(r),e.options.download&&t.appendChild(s),t.appendChild(o),e.carousel.insertAdjacentHTML("afterbegin",t.outerHTML),e.carousel.addEventListener("click",u,!1),n.autoMove(e.carousel)}function o(e){var t=document.createElement("div"),n=document.createElement("ul");e.carousel.className="carousel",t.className="viewport",n.className="filmstrip",e.options.bg&&(t.style.backgroundColor=e.options.bg),e.carousel.style.width=e.options.w+"px",e.carousel.style.height=e.options.h+"px",n.style.width=e.options.w*e.images.length+"px",n.dataset.totalWidth=e.options.w*e.images.length,e.carousel.dataset.viewingWidth=e.options.w,e.images.forEach(function(t){var r=document.createElement("li"),i=document.createElement("img");r.style.width=e.options.w+"px",i.src=t.path,i.alt=t.title,i.title=t.title,i.onload=function(){e.options.viewMode=="landscape"?this.height>e.options.h?this.style.height="100%":this.parentNode.style.lineHeight=e.options.h+"px":this.height>e.options.h?this.style.height="100%":(this.parentNode.style.lineHeight=e.options.h+"px",this.width>e.options.w&&(this.style.width="100%"))},r.appendChild(i),n.appendChild(r)}),t.appendChild(n),e.carousel.appendChild(t)}function u(e){var t=e.target||e.srcElement,r=t.className;r.indexOf("chevron")>-1?(n.moveCarouselByStep(this,Number(t.dataset.step)),n.stopCarousel(this),n.autoMove(this)):r.indexOf("download")>-1?n.downloadVisiblePhotoHandler(this,t):r.indexOf("pause")>-1&&n.pauseButtonHandler(this,t)}var n=e.CAROUSELCONTROLLER||{},r=t||{};return r.renderImagesAndNavigation=i,r}(this,CAROUSELVIEW),CAROUSEL=function(e,t){"use strict";function o(e){this.carousel=document.getElementById(e.divId),this.id=e.divId,this.images=[],this.options={w:e.width||400,h:e.height||300,bg:e.backgroundColor,time:Math.abs(e.tranTime)||1800,download:e.download==="false"?!1:!0},this.options.viewMode=this.options.w>=this.options.h?"landscape":"portrait";var t=this;e.flickrTag?r.handleFlickrRequest(e.flickrTag,function(e){i.renderImagesAndNavigation(e,t)}):n.loadJsonViaAjax(e.jsonPath,function(e){i.renderImagesAndNavigation(e.items,t)})}var n=e.HELPERFUNCTIONS||{},r=e.HELPERFUNCTIONSFLICKR||{},i=e.CAROUSELVIEW||{},s=t||{};return s.Carousel=o,s}(this,CAROUSEL);