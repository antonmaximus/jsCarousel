var HELPERFUNCTIONS=function(t){"use strict";function e(t,e){var a=new XMLHttpRequest;a.onreadystatechange=function(){4===a.readyState&&(200===a.status?e(JSON.parse(a.responseText)):console.error(a))},a.open("GET",t,!0),a.send()}function a(t,e){for(var a=t.children.length-1;a>=0;a--)if(t.children[a].className.indexOf(e)>-1)return t.children[a];console.log("ERROR: child not found")}var i=t||{};return i.loadJsonViaAjax=e,i.getChildWithClassName=a,i}(HELPERFUNCTIONS),HELPERFUNCTIONSFLICKR=function(t){"use strict";function e(t){var e=n.pop();if(0===t.items.length){var a="Your keyword '"+e[0]+"' did not match any pic tags on Flickr. Carousel won't be created.";return void alert(a)}var i=t.items.map(function(t){return{path:t.media.m.replace("_m.jpg","_z.jpg"),title:t.title}}),s=e[1];s(i)}function a(t,e){n.push([t,e]);var a=document.createElement("script");a.type="text/javascript",a.src="http://api.flickr.com/services/feeds/photos_public.gne?tags="+t+"+pic+%22&tagmode=any&format=json&jsoncallback=HELPERFUNCTIONSFLICKR.jsonFlickrFeedHandler",document.body.appendChild(a)}var i=t||{};i.handleFlickrRequest=a,i.jsonFlickrFeedHandler=e;var n=[];return i}(HELPERFUNCTIONSFLICKR),CAROUSELCONTROLLER=function(t,e){"use strict";function a(t){clearInterval(t.dataset.intervId),t.dataset.intervId=""}function i(t){var e=Number(t.dataset.autoStep),a=Number(t.dataset.time),i=setInterval(function(){n(t,e)},a);t.dataset.intervId=i}function n(t,e){var a=r.getChildWithClassName(r.getChildWithClassName(t,"viewport"),"filmstrip"),i=Number(a.style.marginLeft.replace("px","")),n=Number(a.dataset.totalWidth);i+=e,Math.abs(i)===n?i=0:i>0&&(i=-(n-e)),a.style.marginLeft=i+"px",t.dataset.autoStep=e}function s(t,e){var a=r.getChildWithClassName(r.getChildWithClassName(t,"viewport"),"filmstrip"),i=Number(a.style.marginLeft.replace("px","")),n=Number(t.dataset.viewingWidth),s=Math.abs(i/n),o=a.children[s].firstChild;e.download=o.alt.trim().split(" ").join("_").split('"').join("").split("'").join(""),e.href=o.src}function o(t){t.dataset.intervId?a(t):i(t)}var r=t.HELPERFUNCTIONS||{},l=e||{};return l.stopCarousel=a,l.autoMove=i,l.moveCarouselByStep=n,l.downloadVisiblePhotoHandler=s,l.pauseButtonHandler=o,l}(this,CAROUSELCONTROLLER),CAROUSELVIEW=function(t,e){"use strict";function a(t,e){e.images=t.slice(),n(e),i(e)}function i(t){var e=document.createElement("div"),a=document.createElement("div"),i=document.createElement("div"),n=document.createElement("a"),r=document.createElement("a");e.className="navigation",a.className="chevron rightChev",i.className="chevron leftChev",n.className="download",r.className="pause",a.dataset.step=-t.options.w,i.dataset.step=t.options.w,t.carousel.dataset.autoStep=-t.options.w,t.carousel.dataset.time=t.options.time,n.download=!0,e.appendChild(i),e.appendChild(a),t.options.download&&e.appendChild(n),e.appendChild(r),t.carousel.insertAdjacentHTML("afterbegin",e.outerHTML),t.carousel.addEventListener("click",s,!1),o.autoMove(t.carousel)}function n(t){var e=document.createElement("div"),a=document.createElement("ul");t.carousel.className="carousel",e.className="viewport",a.className="filmstrip",t.options.bg&&(e.style.backgroundColor=t.options.bg),t.carousel.style.width=t.options.w+"px",t.carousel.style.height=t.options.h+"px",a.style.width=t.options.w*t.images.length+"px",a.dataset.totalWidth=t.options.w*t.images.length,t.carousel.dataset.viewingWidth=t.options.w,t.images.forEach(function(e){var i=document.createElement("li"),n=document.createElement("img");i.style.width=t.options.w+"px",n.src=e.path,n.alt=e.title,n.title=e.title,n.onload=function(){"landscape"==t.options.viewMode?this.height>t.options.h?this.style.height="100%":this.parentNode.style.lineHeight=t.options.h+"px":this.height>t.options.h?this.style.height="100%":(this.parentNode.style.lineHeight=t.options.h+"px",this.width>t.options.w&&(this.style.width="100%"))},i.appendChild(n),a.appendChild(i)}),e.appendChild(a),t.carousel.appendChild(e)}function s(t){var e=t.target||t.srcElement,a=e.className;a.indexOf("chevron")>-1?(o.moveCarouselByStep(this,Number(e.dataset.step)),o.stopCarousel(this),o.autoMove(this)):a.indexOf("download")>-1?o.downloadVisiblePhotoHandler(this,e):a.indexOf("pause")>-1&&o.pauseButtonHandler(this,e)}var o=t.CAROUSELCONTROLLER||{},r=e||{};return r.renderImagesAndNavigation=a,r}(this,CAROUSELVIEW),CAROUSEL=function(t,e){"use strict";function a(t){this.carousel=document.getElementById(t.divId),this.id=t.divId,this.images=[],this.options={w:t.width||400,h:t.height||300,bg:t.backgroundColor,time:Math.abs(t.tranTime)||1800,download:"false"!==t.download},this.options.viewMode=this.options.w>=this.options.h?"landscape":"portrait";var e=this;t.flickrTag?n.handleFlickrRequest(t.flickrTag,function(t){s.renderImagesAndNavigation(t,e)}):i.loadJsonViaAjax(t.jsonPath,function(t){s.renderImagesAndNavigation(t.items,e)})}var i=t.HELPERFUNCTIONS||{},n=t.HELPERFUNCTIONSFLICKR||{},s=t.CAROUSELVIEW||{},o=e||{};return o.Carousel=a,o}(this,CAROUSEL);